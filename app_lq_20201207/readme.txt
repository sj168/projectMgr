#################################################################################################
#	本文档用以记录轨道线路巡检项目软件工程在开发/升级过程中产生的修改细节					#
#								sj	2020.05.25		#
#################################################################################################

1.2020.05.25	sj	基础版本：app_20200225
			该版本作为具有相机参数设置及图像采集功能的基础版本
			1.具备设置曝光/增益/采集率/像素格式/宽高等功能
			2.可获取宽高/图片大小等功能
			3.可通过相机采集图像并拍照。
			TODO：
				1）在充分了解相机参数的基础上，设置触发模式等功能需进一步完善；
				2）软件待优化和完善，如析构对内存的释放/状态标志位的重置等。

2.2020.05.26	sj	app_20200526（基础版本：app_20200225）
			1.优化了部分标志位的使用，如线程退出exit标志/是否正在采集grabbing_image标志位；
			2.相机重连线程cameraReconnectProcess()仍需优化。

3.2020.05.28	sj	app_20200527（基础版本：app_20200226）
			1.实测发现，用户所设置相机参数在相机重新上电后会恢复默认值，即丢失。增加了相机参数设置保存和重载功能，即每设置一个参数（如曝光）后将其保存到/home/tye/DALSA_CFG/userSettingFile.txt文件中，下次上电时可通过其恢复配置。但软件还有bug，第二次执行保存参数的函数时会报错（terminate called after throwing an instance of 'GenICam_3_0::AccessException'	 Aborted）。

4.2020.06.01	sj	app_lq_20200601（基础版本：app_20200527）
			1.该版本作为LQ项目基础版本，是在线路巡检项目基础上继续开发；
			2.集成了图片压缩代码模块，待测试。

5.2020.06.02	sj	app_lq_20200602（基础版本：app_20200601）
			1.集成了自己封装的TCP类，用于跟上位机通信获取用户命令；
			2.已可与上位机正常通信，并可完成曝光/宽高等简单功能设置，仍需根据协议完善功能。

6.2020.06.05	sj	app_lq_20200605（基础版本：app_20200602）
			1.集成了自己封装的UDP类，用于向上位机传输图像数据；
			
7.2020.06.10	sj	app_lq_20200610（基础版本：app_20200605）
			1.上下位机代码通信OK，下位机编译通过，待测试功能。

8.2020.06.11	sj	app_lq_20200611（基础版本：app_20200610）
			1.简单测试了相机拍照功能，下位机可以发送图像数据，但上位机未触发udp接收函数，待测试解决。

9.2020.06.18	sj	app_lq_20200618（基础版本：app_20200611）
			1.增加上位机设置相机参数设置采集帧率功能；

ps：因软件架构改写，同时接手文档编制任务，软件编写断断续续，因此近期未更新修改细节，后续以app_lq_20200710作为基础版本。
10.2020.07.10	sj	基础版本：app_lq_20200710
			1.实现了相机基本参数设置，如增益、曝光、帧率、宽高等；
			2.实现了相机连续采图，并传给上位机显示；
			3.软触发功能暂时通过抓取单帧图像数据实现，后续需具体实现；
			4.上位机还存在bug，比如参数值上下限等，待优化；
			5.下位机稳定性待测试，并提供接口调用算法；

8.2020.07.14	sj	app_lq_20200714（基础版本：app_20200710）
			1.删除了老版本上startImageTransfer()函数以及对应的线程函数；
			2.实现了软触发功能，需要先调用GevStartTransfer()；
				具体逻辑：设置TriggerSelector->FrameStart，然后打开触发模式TriggerMode->On，设置触发源TriggerSource->Software，打开传输流GevStartTransfer(handle， -1)，再调用软触发接口int cmd = 1;GevSetFeatureValue(handle, "TriggerSoftware", sizeof(UINT32), &cmd);

9.2020.07.20	sj	app_lq_20200720（基础版本：app_20200714）
			1.用GenICam方式和DALSA提供的API均实现了软触发；
			2.实现了图像压缩，并验证保存在本地的压缩图像，验证OK，但上传到上位机显示仍有问题，需在上位机完善该功能；
			3.调试相机传给ARM板丢包问题，暂推测为linux防火墙的问题。

10.2020.07.21	sj	app_lq_20200721（基础版本：app_20200720）
			1.问题：修复了重新设置宽高后，采集图片软件段错误的问题。
			分析：因相机初始化时分配了固定大小接收图像数据buff，而重新指定图像宽高时，当分辨率大于分配空间时，使用内存会越界。
			解决：修改宽高时，重新分配接收缓冲区。

11.2020.08.19	sj	app_lq_20200819（基础版本：app_20200721）
			1.实现TX2对相机采集图像压缩后上传到上位机显示，软触发及连续采集均可。

12.2020.08.21	sj	app_lq_20200821（基础版本：app_20200819）
			1.对软件进行梳理，删除部分不必要代码；
			2.实现相机采集帧数、采集帧率等性能统计上传。

13.2020.09.02	sj	app_lq_20200902（基础版本：app_20200821）
			1.将图像传输方式由UDP修改为TCP（非阻塞修改为阻塞）；
			2.指令及其它报文修改为UDP；
			3.实现了设置相机为软触发模式以后，再设置为非触发模式。

14.2020.09.07	sj	app_lq_20200908（基础版本：app_lq_20200902）
			app_lq_20200907工程在运行时偶尔会报段错误，暂时没有完全确认原因，只是根据测试隔离到可能跟用户配置文件路径有关，之前用宏定义为USER_CAMERA_CONFIG，而该工程用Inifile提供的API去setting文件获取，可能跟实际路径有空格有关系，目前已将其还原为宏定义的方式（该原因可能性比较大），同时将之前封装的CIniFile类也还原成C语言方式（可能跟修改为类无关），目前测试未发现问题，后续继续测试。

15.2020.09.17	sj	app_lq_20200917（基础版本：app_lq_20200907）
			1.增加设置图像宽高时，当前相机工作状态检测，若正在工作，则不允许设置；
			2.稳定性待测试。

16.2020.09.30	sj	app_lq_20200930（基础版本：app_lq_20200917）
			1.增加了timer线程，定时（10s）向上位机发送相机参数，后续获取设备状态也可放于该线程定时向上位机传达信息；
			2.根据近期的测试，该版本比较稳定，目前尚未发现有明显的bug。

17.2020.11.04	sj	app_lq_20201104（基础版本：app_lq_20200930）
			1.下位机增加了硬触发功能；
			2.增加算法识别库的调用，暂时能实现算法调用，功能仍需和算法一起完善；
			3.修改了代码架构，按类增加上级目录，同时修改makefile。

18.2020.12.07	sj	app_lq_20201207（基础版本：app_lq_20201104）
			1.在 timer 线程里使用GenApi接口获取相机实时参数上传上位机更新控件；
			2.增加Log类，将必要信息打印至日志文件，路径为$HOME/autoStart/log；
			3.将相机采集帧数由16位计数修改为unsigned long long，通过统计帧序0xffff的次数；
			4.增加相机IP、设备（开发板）IP，及系统时间设置功能，但相机和设备IP设置功能暂未开放给上位机；
			备注：该版本软件暂时运行于LQ设备中Jetson NX开发板上，2020-12-07修改相机驱动GigE-V-Framework_2.10.0.0157为GigE-V-Framework_2.20.1.0174，修改后的版本为DALSA厂商提供的测试版，因此需要长时间运行测试其稳定性。